<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAML Resume Editor</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4 text-center">YAML Resume Editor</h1>
    <div class="mb-3">
        <input type="text" id="resumeName" class="form-control" placeholder="Enter resume name">
    </div>
    <div id="editor" class="border p-3" style="height: 300px;"></div>
    <div class="d-flex justify-content-between mt-3">
        <button id="saveBtn" class="btn btn-success"><i class="fas fa-save"></i> Save</button>
        <button id="addNewBtn" class="btn btn-primary"><i class="fas fa-plus"></i> Add New</button>
    </div>
    <ul id="resumeList" class="list-group mt-3"></ul>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

<script>
    const editor = ace.edit("editor");
    editor.session.setMode("ace/mode/yaml");
    editor.setTheme("ace/theme/github");

    $('#saveBtn').on('click', function () {
        try {
            const yamlData = editor.getValue();
            const parsedData = jsyaml.load(yamlData);  // Validate YAML data
            const resumeName = $('#resumeName').val() || `Resume ${Date.now()}`;
            let resumes = JSON.parse(localStorage.getItem('resumes')) || {};
            resumes[resumeName] = yamlData;
            localStorage.setItem('resumes', JSON.stringify(resumes));
            loadResumes();
            alert('YAML saved successfully!');
        } catch (e) {
            alert('Invalid YAML data.');
        }
    });

    $('#addNewBtn').on('click', function () {
        editor.setValue('');
        $('#resumeName').val('');
    });

    function loadResumes() {
        const resumes = JSON.parse(localStorage.getItem('resumes')) || {};
        $('#resumeList').empty();
        for (const [name, resume] of Object.entries(resumes)) {
            const defaultBadge = localStorage.getItem('defaultResume') === name ? 
                '<span class="badge bg-primary ms-2">defualt</span>' : '';
            const resumeItem = `<li class="list-group-item d-flex justify-content-between align-items-center">
                ${name} ${defaultBadge}
                <span>
                    <button class="btn btn-sm btn-primary me-2 setDefault" data-name="${name}" title="Set as Default"><i class="fas fa-star"></i></button>
                    <button class="btn btn-sm btn-secondary me-2 editResume" data-name="${name}" title="Edit"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-danger deleteResume" data-name="${name}" title="Delete"><i class="fas fa-trash-alt"></i></button>
                </span>
            </li>`;
            $('#resumeList').append(resumeItem);
        }
    }

    loadResumes();

    $(document).on('click', '.editResume', function () {
        const name = $(this).data('name');
        const resumes = JSON.parse(localStorage.getItem('resumes'));
        editor.setValue(resumes[name]);
        $('#resumeName').val(name);
    });

    $(document).on('click', '.deleteResume', function () {
        const name = $(this).data('name');
        let resumes = JSON.parse(localStorage.getItem('resumes'));
        delete resumes[name];
        localStorage.setItem('resumes', JSON.stringify(resumes));
        loadResumes();
        editor.setValue('');
        $('#resumeName').val('');
    });

    $(document).on('click', '.setDefault', function () {
        const name = $(this).data('name');
        localStorage.setItem('defaultResume', name);
        loadResumes();
    });

    function loadDefaultResume() {
        const defaultResume = localStorage.getItem('defaultResume');
        if (defaultResume) {
            const resumes = JSON.parse(localStorage.getItem('resumes'));
            if (resumes[defaultResume]) {
                editor.setValue(resumes[defaultResume]);
                $('#resumeName').val(defaultResume);
            }
        }
    }

    loadDefaultResume();
</script>
</body>
</html>
